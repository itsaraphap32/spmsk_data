<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบแสดงข้อมูลสถิตินักเรียน</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f0f4f8;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .nav-item {
            transition: all 0.2s ease;
        }
        
        .nav-item:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        .active-tab {
            border-bottom: 3px solid #3b82f6;
            color: #1e40af;
            font-weight: 600;
        }
        
        .data-card {
            transition: all 0.3s ease;
        }
        
        .data-card:hover {
            transform: translateY(-5px);
        }

        .file-upload {
            position: relative;
            overflow: hidden;
            margin: 10px 0;
            cursor: pointer;
        }
        
        .file-upload input[type=file] {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 100%;
            min-height: 100%;
            font-size: 100px;
            text-align: right;
            filter: alpha(opacity=0);
            opacity: 0;
            outline: none;
            background: white;
            cursor: inherit;
            display: block;
        }
        
        .upload-btn {
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-gradient-to-r from-blue-700 to-blue-900 text-white shadow-lg">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                    <h1 class="text-xl md:text-2xl font-bold">ระบบแสดงข้อมูลสถิตินักเรียน</h1>
                </div>
                <div class="hidden md:flex space-x-4">
                    <button id="uploadDataBtn" class="px-3 py-1 rounded-md bg-white bg-opacity-20 hover:bg-opacity-30 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                        อัปโหลดข้อมูล
                    </button>
                    <button class="px-3 py-1 rounded-md bg-white bg-opacity-20 hover:bg-opacity-30 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        2568
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white shadow">
            <div class="container mx-auto px-4">
                <div class="flex overflow-x-auto whitespace-nowrap py-2">
                    <button class="nav-item px-4 py-2 text-gray-700 active-tab" data-tab="overview">ภาพรวม</button>
                    <button class="nav-item px-4 py-2 text-gray-700" data-tab="by-grade">จำแนกตามชั้นเรียน</button>
                    <button class="nav-item px-4 py-2 text-gray-700" data-tab="by-age">จำแนกตามอายุ</button>
                    <button class="nav-item px-4 py-2 text-gray-700" data-tab="special-needs">นักเรียนพิการ</button>
                    <button class="nav-item px-4 py-2 text-gray-700" data-tab="disadvantaged">นักเรียนขาดแคลน</button>
                    <button class="nav-item px-4 py-2 text-gray-700" data-tab="nationality">จำแนกตามสัญชาติ</button>
                    <button class="nav-item px-4 py-2 text-gray-700" data-tab="dormitory">นักเรียนพักนอน</button>
                    <button class="nav-item px-4 py-2 text-gray-700" data-tab="g-code">นักเรียนรหัส G</button>
                </div>
            </div>
        </nav>

        <!-- Upload Modal -->
        <div id="uploadModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">อัปโหลดข้อมูล</h3>
                    <button id="closeUploadModal" class="text-gray-500 hover:text-gray-700">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">1. จำนวนนักเรียนแยกชั้น,เพศ</label>
                        <div class="file-upload w-full">
                            <label for="gradeGenderFile" class="upload-btn flex items-center justify-center w-full px-4 py-2 bg-blue-50 text-blue-700 border border-blue-300 rounded-md hover:bg-blue-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                                เลือกไฟล์
                            </label>
                            <input id="gradeGenderFile" type="file" accept=".csv, .json" class="hidden" />
                        </div>
                        <p id="gradeGenderFileName" class="mt-1 text-sm text-gray-500">ยังไม่ได้เลือกไฟล์</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">2. จำนวนนักเรียนจำแนกตามอายุ</label>
                        <div class="file-upload w-full">
                            <label for="ageFile" class="upload-btn flex items-center justify-center w-full px-4 py-2 bg-blue-50 text-blue-700 border border-blue-300 rounded-md hover:bg-blue-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                                เลือกไฟล์
                            </label>
                            <input id="ageFile" type="file" accept=".csv, .json" class="hidden" />
                        </div>
                        <p id="ageFileName" class="mt-1 text-sm text-gray-500">ยังไม่ได้เลือกไฟล์</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">3. จำนวนนักเรียนพิการ</label>
                        <div class="file-upload w-full">
                            <label for="disabilityFile" class="upload-btn flex items-center justify-center w-full px-4 py-2 bg-blue-50 text-blue-700 border border-blue-300 rounded-md hover:bg-blue-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                                เลือกไฟล์
                            </label>
                            <input id="disabilityFile" type="file" accept=".csv, .json" class="hidden" />
                        </div>
                        <p id="disabilityFileName" class="mt-1 text-sm text-gray-500">ยังไม่ได้เลือกไฟล์</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">4. จำนวนนักเรียนขาดแคลน</label>
                        <div class="file-upload w-full">
                            <label for="disadvantagedFile" class="upload-btn flex items-center justify-center w-full px-4 py-2 bg-blue-50 text-blue-700 border border-blue-300 rounded-md hover:bg-blue-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                                เลือกไฟล์
                            </label>
                            <input id="disadvantagedFile" type="file" accept=".csv, .json" class="hidden" />
                        </div>
                        <p id="disadvantagedFileName" class="mt-1 text-sm text-gray-500">ยังไม่ได้เลือกไฟล์</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">5. จำนวนนักเรียนแยกตามสัญชาติ</label>
                        <div class="file-upload w-full">
                            <label for="nationalityFile" class="upload-btn flex items-center justify-center w-full px-4 py-2 bg-blue-50 text-blue-700 border border-blue-300 rounded-md hover:bg-blue-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                                เลือกไฟล์
                            </label>
                            <input id="nationalityFile" type="file" accept=".csv, .json" class="hidden" />
                        </div>
                        <p id="nationalityFileName" class="mt-1 text-sm text-gray-500">ยังไม่ได้เลือกไฟล์</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">6. จำนวนนักเรียนพักนอน</label>
                        <div class="file-upload w-full">
                            <label for="dormitoryFile" class="upload-btn flex items-center justify-center w-full px-4 py-2 bg-blue-50 text-blue-700 border border-blue-300 rounded-md hover:bg-blue-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                                เลือกไฟล์
                            </label>
                            <input id="dormitoryFile" type="file" accept=".csv, .json" class="hidden" />
                        </div>
                        <p id="dormitoryFileName" class="mt-1 text-sm text-gray-500">ยังไม่ได้เลือกไฟล์</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">7. จำนวนนักเรียนรหัส G</label>
                        <div class="file-upload w-full">
                            <label for="gCodeFile" class="upload-btn flex items-center justify-center w-full px-4 py-2 bg-blue-50 text-blue-700 border border-blue-300 rounded-md hover:bg-blue-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                                เลือกไฟล์
                            </label>
                            <input id="gCodeFile" type="file" accept=".csv, .json" class="hidden" />
                        </div>
                        <p id="gCodeFileName" class="mt-1 text-sm text-gray-500">ยังไม่ได้เลือกไฟล์</p>
                    </div>
                </div>
                <div class="mt-6 flex justify-end">
                    <button id="processDataBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">ประมวลผลข้อมูล</button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="flex-grow container mx-auto px-4 py-6">
            <!-- Filter Section -->
            <div class="bg-white rounded-lg shadow p-4 mb-6">
                <div class="flex flex-wrap items-center gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">รายชื่อโรงเรียน</label>
                        <select class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option>ทั้งหมด</option>
                            <option>โรงเรียน วิทยาศาสตร์จุฬาภรณราชวิทยาลัย สระแก้ว</option>
                            <option>โรงเรียน คลองหาดพิทยาคม</option>
                            <option>โรงเรียน วังน้ำเย็นวิทยาคม</option>
                            <option>โรงเรียน สระแก้ว</option>
                            <option>โรงเรียน วังหลังวิทยาคม</option>
                            <option>โรงเรียน ท่าเกษมพิทยา</option>
                            <option>โรงเรียน วังสมบูรณ์วิทยาคม</option>
                            <option>โรงเรียน วังไพรวิทยาคม</option>
                            <option>โรงเรียน อรัญประเทศ</option>
                            <option>โรงเรียน ทัพราชวิทยา</option>
                            <option>โรงเรียน คลองน้ำใสวิทยาคาร</option>
                            <option>โรงเรียน ร่มเกล้าวัฒนานคร สระแก้ว รัชมังคลาภิเษก</option>
                            <option>โรงเรียน ซับม่วงวิทยา</option>
                            <option>โรงเรียน ตาพระยา</option>
                            <option>โรงเรียน ทัพพระยาพิทยา</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ปีการศึกษา</label>
                        <select class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option>2568</option>
                            <option>2567</option>
                            <option>2566</option>
                            <option>2565</option>
                            <option>2564</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ภาคเรียน</label>
                        <select class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option>1</option>
                            <option>2</option>
                        </select>
                    </div>
                    <div class="ml-auto">
                        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                            ค้นหา
                        </button>
                    </div>
                </div>
            </div>

            <!-- Data Status Alert -->
            <div id="dataStatusAlert" class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm text-yellow-700">
                            กรุณาอัปโหลดข้อมูลเพื่อแสดงผลสถิตินักเรียน โดยคลิกที่ปุ่ม "อัปโหลดข้อมูล" ด้านบน
                        </p>
                    </div>
                </div>
            </div>

            <!-- Tab Content -->
            <div id="tab-content">
                <!-- Overview Tab -->
                <div id="overview" class="tab-pane active">
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow p-4 border-l-4 border-blue-500 data-card">
                            <div class="flex justify-between">
                                <div>
                                    <p class="text-sm text-gray-500">จำนวนนักเรียนทั้งหมด</p>
                                    <p id="totalStudents" class="text-2xl font-bold">0</p>
                                </div>
                                <div class="bg-blue-100 rounded-full p-2 h-fit">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-2 text-sm">
                                <span id="totalMale" class="text-blue-600">ชาย 0</span> | <span id="totalFemale" class="text-pink-600">หญิง 0</span>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-4 border-l-4 border-green-500 data-card">
                            <div class="flex justify-between">
                                <div>
                                    <p class="text-sm text-gray-500">นักเรียนพิการ</p>
                                    <p id="totalDisabled" class="text-2xl font-bold">0</p>
                                </div>
                                <div class="bg-green-100 rounded-full p-2 h-fit">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-2 text-sm">
                                <span id="disabledPercent" class="text-green-600">คิดเป็น 0% ของนักเรียนทั้งหมด</span>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-4 border-l-4 border-purple-500 data-card">
                            <div class="flex justify-between">
                                <div>
                                    <p class="text-sm text-gray-500">นักเรียนขาดแคลน</p>
                                    <p id="totalDisadvantaged" class="text-2xl font-bold">0</p>
                                </div>
                                <div class="bg-purple-100 rounded-full p-2 h-fit">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-2 text-sm">
                                <span id="disadvantagedPercent" class="text-purple-600">คิดเป็น 0% ของนักเรียนทั้งหมด</span>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-4 border-l-4 border-amber-500 data-card">
                            <div class="flex justify-between">
                                <div>
                                    <p class="text-sm text-gray-500">นักเรียนพักนอน</p>
                                    <p id="totalDormitory" class="text-2xl font-bold">0</p>
                                </div>
                                <div class="bg-amber-100 rounded-full p-2 h-fit">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-2 text-sm">
                                <span id="dormitoryPercent" class="text-amber-600">คิดเป็น 0% ของนักเรียนทั้งหมด</span>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow p-4">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">จำนวนนักเรียนแยกตามระดับชั้น</h3>
                                <div class="flex space-x-2">
                                    <button class="text-sm text-gray-500 hover:text-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="gradeChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-4">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">จำนวนนักเรียนแยกตามอายุ</h3>
                                <div class="flex space-x-2">
                                    <button class="text-sm text-gray-500 hover:text-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="ageChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow p-4">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">นักเรียนพิการแยกตามประเภท</h3>
                                <div class="flex space-x-2">
                                    <button class="text-sm text-gray-500 hover:text-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="disabilityChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-4">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">นักเรียนแยกตามสัญชาติ</h3>
                                <div class="flex space-x-2">
                                    <button class="text-sm text-gray-500 hover:text-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="nationalityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- By Grade Tab (Hidden by default) -->
                <div id="by-grade" class="tab-pane hidden">
                    <div class="bg-white rounded-lg shadow p-4 mb-6">
                        <h3 class="text-lg font-semibold mb-4">จำนวนนักเรียนแยกตามระดับชั้นและเพศ</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ระดับชั้น</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ชาย</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">หญิง</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">รวม</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ร้อยละ</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="gradeTable">
                                    <!-- Data will be inserted here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="chart-container h-96">
                            <canvas id="gradeDetailChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Other tabs would be defined here but hidden by default -->
                <div id="by-age" class="tab-pane hidden">
                    <div class="bg-white rounded-lg shadow p-4 mb-6">
                        <h3 class="text-lg font-semibold mb-4">จำนวนนักเรียนจำแนกตามอายุ</h3>
                        <div class="chart-container h-96">
                            <canvas id="ageDetailChart"></canvas>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow p-4">
                            <h4 class="text-md font-semibold mb-3">อายุเฉลี่ยของนักเรียนแต่ละระดับชั้น</h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ระดับชั้น</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">อายุเฉลี่ย (ปี)</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200" id="ageAvgTable">
                                        <!-- Data will be inserted here by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-4">
                            <h4 class="text-md font-semibold mb-3">สัดส่วนนักเรียนตามช่วงอายุ</h4>
                            <div class="chart-container">
                                <canvas id="ageGroupChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="special-needs" class="tab-pane hidden">
                    <div class="bg-white rounded-lg shadow p-4 mb-6">
                        <h3 class="text-lg font-semibold mb-4">ข้อมูลนักเรียนพิการ</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="chart-container">
                                <canvas id="disabilityDetailChart"></canvas>
                            </div>
                            <div>
                                <h4 class="text-md font-semibold mb-3">สัดส่วนนักเรียนพิการแยกตามเพศ</h4>
                                <div class="chart-container">
                                    <canvas id="disabilityGenderChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <h4 class="text-md font-semibold mb-3">จำนวนนักเรียนพิการแยกตามระดับชั้น</h4>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ระดับชั้น</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">จำนวน (คน)</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ร้อยละ</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="disabilityGradeTable">
                                    <!-- Data will be inserted here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="disadvantaged" class="tab-pane hidden">
                    <div class="bg-white rounded-lg shadow p-4 mb-6">
                        <h3 class="text-lg font-semibold mb-4">ข้อมูลนักเรียนขาดแคลน</h3>
                        <div class="chart-container h-96">
                            <canvas id="disadvantagedChart"></canvas>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow p-4">
                            <h4 class="text-md font-semibold mb-3">สัดส่วนนักเรียนขาดแคลนแยกตามเพศ</h4>
                            <div class="chart-container">
                                <canvas id="disadvantagedGenderChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-4">
                            <h4 class="text-md font-semibold mb-3">จำนวนนักเรียนขาดแคลนแยกตามระดับชั้น</h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ระดับชั้น</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">จำนวน (คน)</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ร้อยละ</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200" id="disadvantagedGradeTable">
                                        <!-- Data will be inserted here by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="nationality" class="tab-pane hidden">
                    <div class="bg-white rounded-lg shadow p-4 mb-6">
                        <h3 class="text-lg font-semibold mb-4">ข้อมูลนักเรียนแยกตามสัญชาติ</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="chart-container">
                                <canvas id="nationalityDetailChart"></canvas>
                            </div>
                            <div>
                                <h4 class="text-md font-semibold mb-3">สัดส่วนนักเรียนไทย/ต่างชาติ</h4>
                                <div class="chart-container">
                                    <canvas id="nationalityRatioChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <h4 class="text-md font-semibold mb-3">จำนวนนักเรียนต่างชาติแยกตามระดับชั้น</h4>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ระดับชั้น</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">จำนวน (คน)</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ร้อยละ</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="foreignerGradeTable">
                                    <!-- Data will be inserted here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="dormitory" class="tab-pane hidden">
                    <div class="bg-white rounded-lg shadow p-4 mb-6">
                        <h3 class="text-lg font-semibold mb-4">ข้อมูลนักเรียนพักนอน</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-md font-semibold mb-3">สัดส่วนนักเรียนพักนอนแยกตามเพศ</h4>
                                <div class="chart-container">
                                    <canvas id="dormitoryGenderChart"></canvas>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-md font-semibold mb-3">สัดส่วนนักเรียนพักนอนต่อนักเรียนทั้งหมด</h4>
                                <div class="chart-container">
                                    <canvas id="dormitoryRatioChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <h4 class="text-md font-semibold mb-3">จำนวนนักเรียนพักนอนแยกตามระดับชั้น</h4>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ระดับชั้น</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">จำนวน (คน)</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ร้อยละ</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="dormitoryGradeTable">
                                    <!-- Data will be inserted here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="g-code" class="tab-pane hidden">
                    <div class="bg-white rounded-lg shadow p-4 mb-6">
                        <h3 class="text-lg font-semibold mb-4">ข้อมูลนักเรียนรหัส G</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-md font-semibold mb-3">สัดส่วนนักเรียนรหัส G แยกตามเพศ</h4>
                                <div class="chart-container">
                                    <canvas id="gCodeGenderChart"></canvas>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-md font-semibold mb-3">สัดส่วนนักเรียนรหัส G ต่อนักเรียนทั้งหมด</h4>
                                <div class="chart-container">
                                    <canvas id="gCodeRatioChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <h4 class="text-md font-semibold mb-3">จำนวนนักเรียนรหัส G แยกตามระดับชั้น</h4>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ระดับชั้น</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">จำนวน (คน)</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ร้อยละ</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="gCodeGradeTable">
                                    <!-- Data will be inserted here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-6">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0">
                        <h3 class="text-lg font-semibold mb-2">ระบบแสดงข้อมูลสถิตินักเรียน</h3>
                        <p class="text-gray-400 text-sm">ข้อมูลสถิติสำหรับการวิเคราะห์และวางแผนการศึกษา</p>
                    </div>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </a>
                    </div>
                </div>
                <div class="mt-6 border-t border-gray-700 pt-4 text-center text-gray-400 text-sm">
                    © 2566 ระบบแสดงข้อมูลสถิตินักเรียน. สำนักงานเขตพื้นที่การศึกษามัธยมศึกษาสระแก้ว. สงวนลิขสิทธิ์.
                </div>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Global data storage
            const appData = {
                gradeGender: null,
                age: null,
                disability: null,
                disadvantaged: null,
                nationality: null,
                dormitory: null,
                gCode: null
            };

            // Tab Navigation
            const navItems = document.querySelectorAll('.nav-item');
            const tabPanes = document.querySelectorAll('.tab-pane');
            
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Hide all tabs
                    tabPanes.forEach(pane => pane.classList.add('hidden'));
                    
                    // Show selected tab
                    document.getElementById(tabId).classList.remove('hidden');
                    
                    // Update active tab styling
                    navItems.forEach(nav => nav.classList.remove('active-tab'));
                    this.classList.add('active-tab');
                });
            });

            // Upload Modal
            const uploadModal = document.getElementById('uploadModal');
            const uploadDataBtn = document.getElementById('uploadDataBtn');
            const closeUploadModal = document.getElementById('closeUploadModal');
            const processDataBtn = document.getElementById('processDataBtn');

            uploadDataBtn.addEventListener('click', function() {
                uploadModal.classList.remove('hidden');
            });

            closeUploadModal.addEventListener('click', function() {
                uploadModal.classList.add('hidden');
            });

            // File input change handlers
            const fileInputs = [
                { id: 'gradeGenderFile', nameId: 'gradeGenderFileName', dataKey: 'gradeGender' },
                { id: 'ageFile', nameId: 'ageFileName', dataKey: 'age' },
                { id: 'disabilityFile', nameId: 'disabilityFileName', dataKey: 'disability' },
                { id: 'disadvantagedFile', nameId: 'disadvantagedFileName', dataKey: 'disadvantaged' },
                { id: 'nationalityFile', nameId: 'nationalityFileName', dataKey: 'nationality' },
                { id: 'dormitoryFile', nameId: 'dormitoryFileName', dataKey: 'dormitory' },
                { id: 'gCodeFile', nameId: 'gCodeFileName', dataKey: 'gCode' }
            ];

            fileInputs.forEach(item => {
                const input = document.getElementById(item.id);
                const nameElement = document.getElementById(item.nameId);

                input.addEventListener('change', function() {
                    if (this.files.length > 0) {
                        nameElement.textContent = this.files[0].name;
                        
                        // Read file
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            try {
                                // Try to parse as JSON
                                const data = JSON.parse(e.target.result);
                                appData[item.dataKey] = data;
                            } catch (error) {
                                // If not JSON, try to parse as CSV
                                try {
                                    Papa.parse(e.target.result, {
                                        header: true,
                                        complete: function(results) {
                                            appData[item.dataKey] = results.data;
                                        }
                                    });
                                } catch (csvError) {
                                    console.error('Error parsing file:', csvError);
                                    nameElement.textContent = 'ไฟล์ไม่ถูกต้อง';
                                }
                            }
                        };
                        reader.readAsText(this.files[0]);
                    }
                });
            });

            // Process data button
            processDataBtn.addEventListener('click', function() {
                // Hide modal
                uploadModal.classList.add('hidden');
                
                // Hide data status alert
                document.getElementById('dataStatusAlert').classList.add('hidden');
                
                // Process and display data
                processData();
            });

            // Sample data for demonstration
            function loadSampleData() {
                // Grade and Gender data
                appData.gradeGender = {
                    kindergarten: { male: 3245, female: 3123 },
                    primary: { male: 10876, female: 10543 },
                    lowerSecondary: { male: 5432, female: 5012 },
                    upperSecondary: { male: 2432, female: 2210 }
                };

                // Age data
                appData.age = {
                    ages: ['3 ปี', '4 ปี', '5 ปี', '6 ปี', '7 ปี', '8 ปี', '9 ปี', '10 ปี', '11 ปี', '12 ปี', '13 ปี', '14 ปี', '15 ปี', '16 ปี', '17 ปี', '18 ปี'],
                    counts: [1245, 2134, 2989, 3245, 3456, 3567, 3678, 3543, 3421, 3345, 3234, 3123, 2876, 2543, 2321, 1053]
                };

                // Disability data
                appData.disability = {
                    types: ['บกพร่องทางการเห็น', 'บกพร่องทางการได้ยิน', 'บกพร่องทางสติปัญญา', 'บกพร่องทางร่างกาย', 'บกพร่องทางการเรียนรู้', 'บกพร่องทางการพูด', 'บกพร่องทางพฤติกรรม', 'ออทิสติก', 'พิการซ้อน'],
                    counts: [87, 124, 198, 156, 432, 76, 65, 54, 53],
                    gender: { male: 747, female: 498 }
                };

                // Disadvantaged data
                appData.disadvantaged = {
                    types: ['ยากจน', 'เด็กถูกทอดทิ้ง', 'เด็กที่ถูกทำร้ายทารุณ', 'เด็กยากจน (มากเป็นพิเศษ)', 'เด็กที่มีปัญหาเกี่ยวกับยาเสพติด', 'กำพร้า', 'ทำงานรับผิดชอบตนเองและครอบครัว', 'มีความด้อยโอกาสมากกว่า 1 ประเภท', 'อื่นๆ'],
                    counts: [2345, 234, 87, 543, 123, 187, 156, 98, 103],
                    gender: { male: 2015, female: 1861 }
                };

                // Nationality data
                appData.nationality = {
                    countries: ['ไทย', 'พม่า', 'ลาว', 'กัมพูชา', 'มาเลเซีย', 'เวียดนาม', 'จีน', 'อื่นๆ'],
                    counts: [42073, 432, 187, 123, 23, 15, 12, 8]
                };

                // Dormitory data
                appData.dormitory = {
                    total: 1532,
                    gender: { male: 823, female: 709 }
                };

                // G Code data
                appData.gCode = {
                    total: 876,
                    gender: { male: 456, female: 420 }
                };

                // Process and display data
                processData();
            }

            // Process and display data
            function processData() {
                // Calculate totals
                const totalMale = appData.gradeGender ? 
                    (appData.gradeGender.kindergarten?.male || 0) + 
                    (appData.gradeGender.primary?.male || 0) + 
                    (appData.gradeGender.lowerSecondary?.male || 0) + 
                    (appData.gradeGender.upperSecondary?.male || 0) : 0;
                
                const totalFemale = appData.gradeGender ? 
                    (appData.gradeGender.kindergarten?.female || 0) + 
                    (appData.gradeGender.primary?.female || 0) + 
                    (appData.gradeGender.lowerSecondary?.female || 0) + 
                    (appData.gradeGender.upperSecondary?.female || 0) : 0;
                
                const totalStudents = totalMale + totalFemale;
                
                const totalDisabled = appData.disability ? 
                    appData.disability.counts.reduce((a, b) => a + b, 0) : 0;
                
                const totalDisadvantaged = appData.disadvantaged ? 
                    appData.disadvantaged.counts.reduce((a, b) => a + b, 0) : 0;
                
                const totalDormitory = appData.dormitory ? appData.dormitory.total : 0;

                // Update summary cards
                document.getElementById('totalStudents').textContent = totalStudents.toLocaleString();
                document.getElementById('totalMale').textContent = `ชาย ${totalMale.toLocaleString()}`;
                document.getElementById('totalFemale').textContent = `หญิง ${totalFemale.toLocaleString()}`;
                
                document.getElementById('totalDisabled').textContent = totalDisabled.toLocaleString();
                document.getElementById('disabledPercent').textContent = `คิดเป็น ${((totalDisabled / totalStudents) * 100).toFixed(1)}% ของนักเรียนทั้งหมด`;
                
                document.getElementById('totalDisadvantaged').textContent = totalDisadvantaged.toLocaleString();
                document.getElementById('disadvantagedPercent').textContent = `คิดเป็น ${((totalDisadvantaged / totalStudents) * 100).toFixed(1)}% ของนักเรียนทั้งหมด`;
                
                document.getElementById('totalDormitory').textContent = totalDormitory.toLocaleString();
                document.getElementById('dormitoryPercent').textContent = `คิดเป็น ${((totalDormitory / totalStudents) * 100).toFixed(1)}% ของนักเรียนทั้งหมด`;

                // Update charts
                updateCharts();
            }

            // Update all charts
            function updateCharts() {
                // Grade Chart
                if (appData.gradeGender) {
                    const gradeCtx = document.getElementById('gradeChart').getContext('2d');
                    new Chart(gradeCtx, {
                        type: 'bar',
                        data: {
                            labels: ['อนุบาล', 'ประถมศึกษา', 'มัธยมศึกษาตอนต้น', 'มัธยมศึกษาตอนปลาย'],
                            datasets: [
                                {
                                    label: 'นักเรียนชาย',
                                    data: [
                                        appData.gradeGender.kindergarten?.male || 0,
                                        appData.gradeGender.primary?.male || 0,
                                        appData.gradeGender.lowerSecondary?.male || 0,
                                        appData.gradeGender.upperSecondary?.male || 0
                                    ],
                                    backgroundColor: 'rgba(54, 162, 235, 0.7)',
                                    borderColor: 'rgba(54, 162, 235, 1)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'นักเรียนหญิง',
                                    data: [
                                        appData.gradeGender.kindergarten?.female || 0,
                                        appData.gradeGender.primary?.female || 0,
                                        appData.gradeGender.lowerSecondary?.female || 0,
                                        appData.gradeGender.upperSecondary?.female || 0
                                    ],
                                    backgroundColor: 'rgba(255, 99, 132, 0.7)',
                                    borderColor: 'rgba(255, 99, 132, 1)',
                                    borderWidth: 1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'จำนวนนักเรียน (คน)'
                                    }
                                }
                            }
                        }
                    });
                }

                // Age Chart
                if (appData.age) {
                    const ageCtx = document.getElementById('ageChart').getContext('2d');
                    new Chart(ageCtx, {
                        type: 'line',
                        data: {
                            labels: appData.age.ages,
                            datasets: [{
                                label: 'จำนวนนักเรียน',
                                data: appData.age.counts,
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                borderColor: 'rgba(75, 192, 192, 1)',
                                borderWidth: 2,
                                tension: 0.3,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'จำนวนนักเรียน (คน)'
                                    }
                                }
                            }
                        }
                    });
                }

                // Disability Chart
                if (appData.disability) {
                    const disabilityCtx = document.getElementById('disabilityChart').getContext('2d');
                    new Chart(disabilityCtx, {
                        type: 'doughnut',
                        data: {
                            labels: appData.disability.types,
                            datasets: [{
                                data: appData.disability.counts,
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.7)',
                                    'rgba(54, 162, 235, 0.7)',
                                    'rgba(255, 206, 86, 0.7)',
                                    'rgba(75, 192, 192, 0.7)',
                                    'rgba(153, 102, 255, 0.7)',
                                    'rgba(255, 159, 64, 0.7)',
                                    'rgba(199, 199, 199, 0.7)',
                                    'rgba(83, 102, 255, 0.7)',
                                    'rgba(255, 99, 255, 0.7)'
                                ],
                                borderColor: [
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)',
                                    'rgba(255, 159, 64, 1)',
                                    'rgba(199, 199, 199, 1)',
                                    'rgba(83, 102, 255, 1)',
                                    'rgba(255, 99, 255, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                    labels: {
                                        font: {
                                            size: 11
                                        }
                                    }
                                }
                            }
                        }
                    });
                }

                // Nationality Chart
                if (appData.nationality) {
                    const nationalityCtx = document.getElementById('nationalityChart').getContext('2d');
                    new Chart(nationalityCtx, {
                        type: 'pie',
                        data: {
                            labels: appData.nationality.countries,
                            datasets: [{
                                data: appData.nationality.counts,
                                backgroundColor: [
                                    'rgba(54, 162, 235, 0.7)',
                                    'rgba(255, 99, 132, 0.7)',
                                    'rgba(255, 206, 86, 0.7)',
                                    'rgba(75, 192, 192, 0.7)',
                                    'rgba(153, 102, 255, 0.7)',
                                    'rgba(255, 159, 64, 0.7)',
                                    'rgba(199, 199, 199, 0.7)',
                                    'rgba(83, 102, 255, 0.7)'
                                ],
                                borderColor: [
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)',
                                    'rgba(255, 159, 64, 1)',
                                    'rgba(199, 199, 199, 1)',
                                    'rgba(83, 102, 255, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right'
                                }
                            }
                        }
                    });
                }

                // Initialize other charts as needed
                // ...
            }

            // Load sample data for demonstration
            loadSampleData();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'962041226465d336',t:'MTc1Mjk5MTM5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
